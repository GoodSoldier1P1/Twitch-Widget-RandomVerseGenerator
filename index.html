<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Verse Widget</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Settings Panel (Unity Inspector Style) */
        #settings-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(40, 40, 40, 0.98);
            border: 2px solid #555;
            border-radius: 8px;
            padding: 15px;
            width: 320px;
            color: #fff;
            font-size: 13px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            max-height: 90vh;
            overflow-y: auto;
            pointer-events: auto;
        }

        #settings-panel.collapsed {
            width: auto;
            padding: 12px;
        }

        #settings-panel.collapsed .settings-content {
            display: none;
        }

        .settings-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #555;
            cursor: pointer;
            user-select: none;
            font-size: 24px;
        }

        #settings-panel.collapsed .settings-header {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .settings-header:hover {
            color: #4a9eff;
        }

        .setting-group {
            margin-bottom: 15px;
        }

        .setting-label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
            font-size: 12px;
            font-weight: 500;
        }

        .setting-input,
        .setting-select {
            width: 100%;
            padding: 8px;
            background: #2a2a2a;
            border: 1px solid #555;
            border-radius: 4px;
            color: #fff;
            font-size: 13px;
        }

        .setting-input:focus,
        .setting-select:focus {
            outline: none;
            border-color: #4a9eff;
        }

        .setting-checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .apply-btn {
            width: 100%;
            padding: 10px;
            background: #4a9eff;
            border: none;
            border-radius: 4px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: background 0.2s;
        }

        .apply-btn:hover {
            background: #3a8eef;
        }

        .apply-btn:active {
            background: #2a7edf;
        }

        .help-text {
            font-size: 11px;
            color: #888;
            margin-top: 4px;
            font-style: italic;
        }

        .divider {
            height: 1px;
            background: #555;
            margin: 15px 0;
        }

        /* Bible Widget Styles */
        #bible-widget {
            font-family: 'Georgia', 'Times New Roman', serif;
            color: #ffffff;
            text-align: center;
            padding: 4%;
            background: linear-gradient(135deg, rgba(0,0,0,0.85), rgba(30,30,30,0.9));
            border-radius: 20px;
            box-shadow: 0 8px 40px rgba(0,0,0,0.8);
            width: 100%;
            height: 100%;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255,255,255,0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #verse-container {
            transition: opacity 1000ms ease-in-out;
            width: 90%;
        }

        .verse-hidden {
            opacity: 0;
        }

        .verse-visible {
            opacity: 1;
        }

        #verse-text {
            font-size: 5.5vmin;
            line-height: 1.8;
            margin-bottom: 1em;
            font-style: italic;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        #verse-reference {
            font-size: 4vmin;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        #loading {
            font-size: 4.5vmin;
            color: #cccccc;
            font-style: italic;
        }

        .hidden {
            display: none;
        }

        /* Hide settings panel when streaming (optional) */
        .hide-settings #settings-panel {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Unity-Style Settings Panel 
    <div id="settings-panel" class="collapsed">
        <div class="settings-header" onclick="toggleSettings()" title="Click to expand/collapse settings (or press 'S' key)">
            ‚öôÔ∏è
        </div>
        
        <div class="settings-content">
            <div class="setting-group">
                <label class="setting-label">üìö Verse Source</label>
                <select id="verse-source" class="setting-select">
                    <option value="ANY">Random (Entire Bible)</option>
                    <option value="NEW_TESTAMENT">New Testament Only</option>
                    <option value="OLD_TESTAMENT">Old Testament Only</option>
                    <option value="GOSPELS">Gospels (Matthew-John)</option>
                    <option value="PSALMS">Psalms Only</option>
                    <option value="PROVERBS">Proverbs Only</option>
                    <option value="JOHN">John Only</option>
                </select>
            </div>

            <div class="setting-group">
                <label class="setting-label">‚è±Ô∏è Update Interval (minutes)</label>
                <input type="number" id="update-interval" class="setting-input" min="1" max="60" value="1">
                <div class="help-text">How often to show a new verse</div>
            </div>

            <div class="setting-group">
                <label class="setting-label">üìè Max Verse Length (characters)</label>
                <input type="number" id="max-length" class="setting-input" min="100" max="1000" value="400">
                <div class="help-text">Longer verses will be truncated</div>
            </div>

            <div class="divider"></div>

            <div class="setting-group">
                <div class="setting-checkbox-group">
                    <input type="checkbox" id="auto-update" class="setting-checkbox" checked>
                    <label class="setting-label" for="auto-update" style="margin: 0;">Auto-Update Verses</label>
                </div>
                <div class="help-text">Automatically cycle through verses</div>
            </div>

            <div class="setting-group">
                <div class="setting-checkbox-group">
                    <input type="checkbox" id="hide-panel" class="setting-checkbox">
                    <label class="setting-label" for="hide-panel" style="margin: 0;">Hide This Panel</label>
                </div>
                <div class="help-text">Refresh page to show again</div>
            </div>

            <button class="apply-btn" onclick="applySettings()">‚úì Apply Settings</button>
            <button class="apply-btn" onclick="refreshVerse()" style="background: #666; margin-top: 8px;">üîÑ Refresh Verse Now</button>
        </div>
    </div>-->

    <!-- Bible Verse Display -->
    <div id="bible-widget">
        <div id="verse-container" class="verse-hidden">
            <div id="verse-text"></div>
            <div id="verse-reference"></div>
        </div>
        <div id="loading" class="hidden">Loading verse...</div>
    </div>

    <script>
        // Configuration with defaults
        const CONFIG = {
            UPDATE_INTERVAL_MINUTES: 1,
            VERSE_SOURCE: 'ANY',
            MAX_VERSE_LENGTH: 400,
            AUTO_UPDATE: true
        };

        const VERSE_SOURCES = {
            ANY: '',
            NEW_TESTAMENT: 'MAT,MRK,LUK,JHN,ACT,ROM,1CO,2CO,GAL,EPH,PHP,COL,1TH,2TH,1TI,2TI,TIT,PHM,HEB,JAM,1PE,2PE,1JN,2JN,3JN,JUD,REV',
            OLD_TESTAMENT: 'GEN,EXO,LEV,NUM,DEU,JOS,JDG,RUT,1SA,2SA,1KI,2KI,1CH,2CH,EZR,NEH,EST,JOB,PSA,PRO,ECC,SNG,ISA,JER,LAM,EZK,DAN,HOS,JOL,AMO,OBA,JON,MIC,NAM,HAB,ZEP,HAG,ZEC,MAL',
            GOSPELS: 'MAT,MRK,LUK,JHN',
            PSALMS: 'PSA',
            PROVERBS: 'PRO',
            JOHN: 'JHN'
        };

        const FALLBACK_VERSES = [
            {
                reference: "John 3:16",
                text: "For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life."
            },
            {
                reference: "Philippians 4:13",
                text: "I can do all things through Christ who strengthens me."
            },
            {
                reference: "Jeremiah 29:11",
                text: "For I know the plans I have for you, declares the Lord, plans to prosper you and not to harm you, to give you hope and a future."
            },
            {
                reference: "Romans 8:28",
                text: "And we know that in all things God works for the good of those who love him, who have been called according to his purpose."
            },
            {
                reference: "Psalm 23:1",
                text: "The Lord is my shepherd, I lack nothing."
            }
        ];

        // Settings Panel Functions
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            panel.classList.toggle('collapsed');
        }

        function loadSettings() {
            try {
                const saved = localStorage.getItem('bibleWidgetSettings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    Object.assign(CONFIG, settings);
                    
                    // Update form values
                    document.getElementById('verse-source').value = CONFIG.VERSE_SOURCE;
                    document.getElementById('update-interval').value = CONFIG.UPDATE_INTERVAL_MINUTES;
                    document.getElementById('max-length').value = CONFIG.MAX_VERSE_LENGTH;
                    document.getElementById('auto-update').checked = CONFIG.AUTO_UPDATE;
                }
            } catch (e) {
                console.log('No saved settings found');
            }
        }

        function saveSettings() {
            try {
                localStorage.setItem('bibleWidgetSettings', JSON.stringify(CONFIG));
            } catch (e) {
                console.log('Could not save settings');
            }
        }

        function applySettings() {
            CONFIG.VERSE_SOURCE = document.getElementById('verse-source').value;
            CONFIG.UPDATE_INTERVAL_MINUTES = parseInt(document.getElementById('update-interval').value);
            CONFIG.MAX_VERSE_LENGTH = parseInt(document.getElementById('max-length').value);
            CONFIG.AUTO_UPDATE = document.getElementById('auto-update').checked;
            
            const hidePanel = document.getElementById('hide-panel').checked;
            if (hidePanel) {
                document.getElementById('settings-panel').style.display = 'none';
            }

            saveSettings();
            
            // Restart the widget with new settings
            if (window.bibleWidget) {
                window.bibleWidget.restart();
            }

            alert('Settings applied! ‚úì');
        }

        function refreshVerse() {
            if (window.bibleWidget) {
                window.bibleWidget.loadRandomVerse();
            }
        }

        // Bible Widget Class
        class BibleVerseWidget {
            constructor() {
                this.currentVerse = null;
                this.isLoading = false;
                this.updateInterval = null;
                this.init();
            }

            init() {
                loadSettings();
                this.startAutoUpdate();
                this.loadRandomVerse();
            }

            restart() {
                // Clear existing interval
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                }
                // Restart with new settings
                this.startAutoUpdate();
                this.loadRandomVerse();
            }

            async loadRandomVerse() {
                if (this.isLoading) return;
                
                this.isLoading = true;
                this.showLoading();

                try {
                    const verse = await this.fetchRandomVerse();
                    this.displayVerse(verse);
                } catch (error) {
                    console.error('Failed to load verse:', error);
                    this.displayFallbackVerse();
                } finally {
                    this.isLoading = false;
                    this.hideLoading();
                }
            }

            async fetchRandomVerse() {
                const sourceCode = VERSE_SOURCES[CONFIG.VERSE_SOURCE] || '';
                let endpoint = 'https://bible-api.com/data/web/random';
                
                if (sourceCode) {
                    endpoint += `/${sourceCode}`;
                }

                console.log('Fetching from:', endpoint);
                
                const response = await fetch(endpoint);
                if (!response.ok) throw new Error(`API request failed with status: ${response.status}`);
                
                const data = await response.json();
                console.log('API Response:', data);
                
                // Parse the actual API structure
                const verse = data.random_verse;
                return {
                    text: verse.text.trim(),
                    reference: `${verse.book} ${verse.chapter}:${verse.verse}`
                };
            }

            displayVerse(verse) {
                const container = document.getElementById('verse-container');
                const textEl = document.getElementById('verse-text');
                const refEl = document.getElementById('verse-reference');

                let displayText = verse.text;
                if (displayText.length > CONFIG.MAX_VERSE_LENGTH) {
                    displayText = displayText.substring(0, CONFIG.MAX_VERSE_LENGTH) + '...';
                }

                container.classList.remove('verse-visible');
                container.classList.add('verse-hidden');

                setTimeout(() => {
                    textEl.textContent = displayText;
                    refEl.textContent = verse.reference;
                    
                    container.classList.remove('verse-hidden');
                    container.classList.add('verse-visible');
                }, 500);

                this.currentVerse = verse;
            }

            displayFallbackVerse() {
                const randomVerse = FALLBACK_VERSES[Math.floor(Math.random() * FALLBACK_VERSES.length)];
                this.displayVerse(randomVerse);
            }

            showLoading() {
                const loadingEl = document.getElementById('loading');
                if (loadingEl) loadingEl.classList.remove('hidden');
            }

            hideLoading() {
                const loadingEl = document.getElementById('loading');
                if (loadingEl) loadingEl.classList.add('hidden');
            }

            startAutoUpdate() {
                if (!CONFIG.AUTO_UPDATE) return;
                
                const intervalMs = CONFIG.UPDATE_INTERVAL_MINUTES * 60 * 1000;
                this.updateInterval = setInterval(() => {
                    this.loadRandomVerse();
                }, intervalMs);
            }
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            window.bibleWidget = new BibleVerseWidget();
        });

        // Keyboard shortcut: Press 'S' to toggle settings
        window.addEventListener('keydown', (e) => {
            if (e.key === 's' || e.key === 'S') {
                toggleSettings();
            }
        });

        // Expose for external commands
        window.refreshBibleVerse = refreshVerse;
    </script>
</body>
</html>
